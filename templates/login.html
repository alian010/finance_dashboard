<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<script src="https://cdn.tailwindcss.com"></script>
	<title>Login | Finance Dashboard</title>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100 flex items-center justify-center p-6">
	<div class="w-full max-w-md bg-slate-900/60 border border-slate-800 rounded-2xl p-6 shadow">
		<h1 class="text-2xl font-semibold">Sign in</h1>

		<form id="loginForm" class="mt-6 space-y-4">
			<div>
				<label class="block text-sm text-slate-300 mb-1">Username</label>
				<input id="username"
					class="w-full rounded-xl bg-slate-950 border border-slate-800 px-4 py-3 outline-none focus:border-slate-600"
					placeholder="your username" autocomplete="username" required />
			</div>

			<div>
				<label class="block text-sm text-slate-300 mb-1">Password</label>
				<input id="password" type="password"
					class="w-full rounded-xl bg-slate-950 border border-slate-800 px-4 py-3 outline-none focus:border-slate-600"
					placeholder="••••••••" autocomplete="current-password" required />
			</div>

			<button type="submit"
				class="w-full rounded-xl bg-white text-slate-950 font-medium py-3 hover:opacity-90 transition">
				Login
			</button>
		</form>

		<!-- Register link -->
		<div class="mt-3 text-sm flex items-center justify-between">
			<a class="text-slate-300 underline hover:text-white transition" href="/api/auth/register-page/">
				Create new account
			</a>
			<span class="text-slate-500 text-xs">Need an account?</span>
		</div>

		<div class="mt-4 text-sm text-slate-400">
			<div class="flex items-center justify-between">
				<span>Status:</span>
				<span id="status" class="text-slate-300">Not logged in</span>
			</div>
		</div>

		<!-- NEW: output area (so JS won't crash) -->
		<pre id="output" class="mt-4 bg-slate-950 border border-slate-800 rounded-xl p-3 text-xs overflow-auto"></pre>
	</div>

	<script>
		const statusEl = document.getElementById("status");
		const outputEl = document.getElementById("output");

		function setOutput(obj) {
			if (!outputEl) return;
			outputEl.textContent = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
		}

		function getAccess() {
			return localStorage.getItem("access_token");
		}

		function setStatus() {
			statusEl.textContent = getAccess() ? "Logged in" : "Not logged in";
		}

		// If already logged in, go to dashboard
		if (getAccess()) {
			window.location.href = "/dashboard/";
		}

		setStatus();

		document.getElementById("loginForm").addEventListener("submit", async (e) => {
			e.preventDefault();

			const username = document.getElementById("username").value.trim();
			const password = document.getElementById("password").value;

			try {
				const res = await fetch("/api/auth/token/", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ username, password }),
				});

				const data = await res.json().catch(() => ({}));

				if (!res.ok) {
					setOutput(data);
					return;
				}

				localStorage.setItem("access_token", data.access);
				localStorage.setItem("refresh_token", data.refresh);

				setStatus();
				setOutput({ message: "Login success ✅ Redirecting to dashboard…", tokens: data });

				// Redirect to dashboard
				window.location.href = "/dashboard/";

			} catch (err) {
				setOutput(String(err));
			}
		});
	</script>
</body>

</html>